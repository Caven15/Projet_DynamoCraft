<div class="container min-vh-75 py-5">
    <!-- Titre du projet -->
    <h2 class="text-center text-warning mb-4 display-4">{{ projet.nom }}</h2>

    <!-- Contenu principal -->
    <div class="row">
        <!-- Colonne de gauche : Image principale et détails -->
        <div class="col-lg-8 mb-4">
            <!-- Carrousel principal -->
            <div id="mainImageCarousel" class="carousel slide shadow-lg rounded-custom" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <!-- Affichage de l'image principale dynamique -->
                    <div *ngFor="let image of projet.imageProjet; let i = index" class="carousel-item" [class.active]="i === 0">
                        <img [src]="url + image.nom" alt="{{ projet.nom }}" class="d-block w-100 img-fluid rounded-custom">
                    </div>
                </div>
                <!-- Boutons de navigation gauche/droite -->
                <button class="carousel-control-prev" type="button" data-bs-target="#mainImageCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Précédent</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#mainImageCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Suivant</span>
                </button>
            </div>

            <!-- Miniatures en dessous du carrousel -->
            <div class="row mt-4">
                <div class="col-2" *ngFor="let image of projet.imageProjet; let i = index">
                    <img [src]="url + image.nom" class="img-fluid rounded shadow thumbnail-img" (click)="selectImage(i)" alt="Miniature {{ i + 1 }}">
                </div>
            </div>

            <!-- Détails du projet -->
            <div class="project-details bg-dc-2 p-4 rounded-custom mt-4 text-light shadow-lg">
                <h5 class="text-warning">Description :</h5>
                <p>{{ projet.description }}</p>

                <h5 class="text-warning">Statistiques :</h5>
                <ul class="list-unstyled">
                    <li>Date de publication : {{ projet.statistique?.datePublication | date }}</li>
                    <li *ngIf="projet.statistique?.dateModification !== projet.statistique?.datePublication">
                        Dernière mise à jour : {{ projet.statistique?.dateModification | date }}
                    </li>
                    <li>Nombre de téléchargements : {{ projet.statistique?.nombreTelechargement }}</li>
                    <li>Nombre de likes : {{ projet.statistique?.nombreApreciation }}</li>
                </ul>

                <div class="d-flex justify-content-around">
                    <!-- Bouton like -->
                    <button class="btn btn-warning btn-lg shadow" (click)="incrementLike()">
                        <i class="bi bi-heart"></i> Liker
                    </button>
                    <!-- Bouton téléchargement -->
                    <button class="btn btn-warning btn-lg shadow" (click)="incrementDownload()">
                        <i class="bi bi-download"></i> Télécharger
                    </button>
                </div>
            </div>
        </div>

        <!-- Colonne de droite : Informations utilisateur -->
        <div class="col-lg-4">
            <div class="user-info bg-dc-2 p-4 rounded-custom shadow-lg text-center text-light">
                <h5 class="text-warning">Publié par :</h5>
                @if (projet.utilisateur) {
                <div class="profile-image-wrapper mx-auto mb-3 profile-circle">
                    <img [src]="url + projet.utilisateur.imageUtilisateur?.nom" class="rounded-circle shadow-lg" alt="Utilisateur" style="width: 150px; height: 150px;">
                </div>
                <h5>{{ projet.utilisateur.pseudo }}</h5>
                } @else {
                <p class="text-muted">Utilisateur inconnu</p>
                }
            </div>
        </div>
    </div>

    <!-- Section des commentaires -->
    <div class="row mt-5">
        <div class="col-lg-8 mx-auto">
            <h4 class="text-warning">Commentaires :</h4>

            <!-- Formulaire pour ajouter un commentaire -->
            <div class="add-comment bg-dc-2 p-4 rounded-custom shadow-lg mb-4 text-light">
                <h5 class="text-warning">Ajouter un commentaire :</h5>
                <textarea [(ngModel)]="newCommentaire" class="form-control mb-3" rows="4" placeholder="Votre commentaire..."></textarea>
                <button class="btn btn-warning shadow" (click)="addComment()">Commenter</button>
            </div>

            <!-- Liste des commentaires -->
            <div class="comments-section">
                @for (commentaire of commentaires; track commentaire.id) {
                <div class="comment bg-dc-2 p-4 rounded-custom shadow-lg mb-3 text-light">
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>{{ commentaire.utilisateur?.pseudo }}</strong>
                            <p *ngIf="editingCommentId !== commentaire.id">{{ commentaire.description }}</p>
                            <!-- Formulaire d'édition -->
                            <textarea [(ngModel)]="editingCommentContent" *ngIf="editingCommentId === commentaire.id" class="form-control mb-3"></textarea>
                        </div>
                        <!-- Actions de modification/suppression si utilisateur est propriétaire -->
                        @if (commentaire.utilisateur && commentaire.utilisateur.id === currentUser?.id) {
                        <div>
                            <button class="btn btn-sm btn-light" *ngIf="editingCommentId !== commentaire.id" (click)="editComment(commentaire)">
                                Modifier
                            </button>
                            <button class="btn btn-sm btn-success" *ngIf="editingCommentId === commentaire.id" (click)="saveComment()">
                                Sauvegarder
                            </button>
                            <button class="btn btn-sm btn-danger" (click)="deleteComment(commentaire.id)">Supprimer</button>
                            <button class="btn btn-sm btn-secondary" *ngIf="editingCommentId === commentaire.id" (click)="cancelEdit()">
                                Annuler
                            </button>
                        </div>
                        }
                    </div>
                </div>
                }
            </div>
        </div>
    </div>
</div>
